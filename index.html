<!DOCTYPE html>
<html lang='en'>
<head>
	<meta charset='UTF-8'>
	<meta http-equiv='X-UA-Compatible' content='IE=Edge'>
	<meta name='viewport' content='width=device-width, initial-scale=1'>
	<title>Engel DEMO</title>
	<link rel='stylesheet' href='style.css'>
</head>

<body>
	<pre id='editor'><code contenteditable='true' spellcheck='false' autocomplete='off'>import io
; Using closures to create a vector object in Engel.

dec vector = (x, y) -> (prop) ->
{
	dec mag = () -> (x * x + y * y) ^ 0.5
	return match prop
	{
		'x' => x
		'y' => y
		
		'mag'    => mag()
		'string' => '[#{x}, #{y}]'
		'norm'   => () -> vector(x / mag(), y / mag())
		
		'normalize' => () ->
		{
			dec m = mag()
			x /= m
			y /= m
		}
		
		'add' => (vec) -> vector(x + vec('x'), y + vec('y'))
		'sub' => (vec) -> vector(x - vec('x'), y - vec('y'))
		'mul' => (vec) -> vector(x * vec('x'), y * vec('y'))
		'div' => (vec) -> vector(x / vec('x'), y / vec('y'))
		
		'dot'   => (vec) -> x * vec('x') + y * vec('y')
		'cross' => (vec) -> x * vec('x') - vec('y') * y
		
		'set' => (prop) -> match prop
		{
			'x' => (a) -> x = a
			'y' => (a) -> y = a
			'mag' => (a) ->
			{
				dec m = mag()
				x /= m * a
				y /= m * a
			}
		}
		else null
	}
	else null
}
let vec1 = vector(20.2, 30)
let vec2 = vec1('add')(vector(12, 45))
io.print('vec1 := #{vec1('string')}')
io.print('vec2 := #{vec2('string')}')</code></pre>
	<pre id='terminal'><code></code></pre>
	<svg id='run' viewBox='0 0 100 100'>
		<circle onclick='run()' stroke='#00FF7F' stroke-width='6%' cx='50%' cy='50%' r='47%'/>
		<path fill='#00FF7F' onclick='run()' d='
			M 35 30
			L 70 50
			L 35 70
			Z'/>
	</svg>
	<script src='main.js'></script>
	
	<script type='module'>
		import { highlight } from './highlighter.js';
		import { Caret } from './caret.js';
		(() =>
		{
			const editor = document.querySelector('#editor code');
			const caret = new Caret(editor);
			highlight(editor);
			(() =>
			{
				let debounce;
				editor.addEventListener('input', e =>
				{
					clearTimeout(debounce);
					debounce = setTimeout(() =>
					{
						highlight(editor);
					}, 100);
					e.preventDefault();
				});
			})();
			editor.addEventListener('keydown', e =>
			{
				const TAB   = 9;
				const ENTER = 13;
				const SPACE = 32;
				switch (e.keyCode)
				{
					case TAB:
					{
						document.execCommand('insertText', false, '\t');
						e.preventDefault();
						break;
					}
					case ENTER:
					{
						const lines = editor.innerText.split('\n');
						const line = editor.innerText.substring(0, caret.getPos()).split('\n').length;
						const spaces = /^[ \t]+/.exec(lines[line - 1]) || '';
						document.execCommand('insertText', false, `\n${spaces}`);
						e.preventDefault();
						break;
					}
				}
			});
		})();
	</script>
</body>
</html>